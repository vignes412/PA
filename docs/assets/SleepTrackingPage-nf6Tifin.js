import{R as N,o as pe,r as E,f as Me,g as _e,N as Qe,D as me,C as he,A as Le,M as fe,z as Ue,j as e,c as Be,B as $,u as $e}from"./pwa-components-DFRzXAPN.js";import{C as P,a as ee,b as te,M as Q,d as C,f as ne}from"./index-DoxOVinb.js";import{B as H}from"./badge-DDeZSJE1.js";import{T as Ae,a as Ee,b as z,c as R}from"./tabs-Ckg3dhe6.js";import{L as W,I as _,a3 as ze,X as Re,h as Ve,a4 as qe,T as xe,Y as Ke,k as ye}from"./DashboardLayout-c4N3lsWj.js";import{S as Ye}from"./save-CCykoWoj.js";import{P as J,C as ge}from"./progress-CwerKmR9.js";import{i as He,D as Ge,K as Xe,M as Je,L as re,f as Z,C as Ze,A as et,h as G,j as tt,n as ie,t as at,k as st,l as Pe,u as rt,G as nt,v as ve,w as it,X as oe,Y as le,y as ot,R as je,z as be,B as Se,F as lt,H as ct,J as ut}from"./BarChart-TnJZMJRX.js";import{P as dt}from"./PageHeader-wjss6V3A.js";import{S as pt}from"./square-pen-Cv09M6XU.js";import{T as mt}from"./trash-2-D7BXSIAU.js";var ht=["type","layout","connectNulls","ref"],ft=["key"];function V(t){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},V(t)}function Te(t,n){if(t==null)return{};var s=xt(t,n),a,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)a=o[r],!(n.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}function xt(t,n){if(t==null)return{};var s={};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){if(n.indexOf(a)>=0)continue;s[a]=t[a]}return s}function X(){return X=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},X.apply(this,arguments)}function we(t,n){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),s.push.apply(s,a)}return s}function A(t){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?we(Object(s),!0).forEach(function(a){F(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):we(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function U(t){return jt(t)||vt(t)||gt(t)||yt()}function yt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gt(t,n){if(t){if(typeof t=="string")return ce(t,n);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ce(t,n)}}function vt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function jt(t){if(Array.isArray(t))return ce(t)}function ce(t,n){(n==null||n>t.length)&&(n=t.length);for(var s=0,a=new Array(n);s<n;s++)a[s]=t[s];return a}function bt(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function De(t,n){for(var s=0;s<n.length;s++){var a=n[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,Fe(a.key),a)}}function St(t,n,s){return n&&De(t.prototype,n),s&&De(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tt(t,n,s){return n=ae(n),wt(t,Ce()?Reflect.construct(n,s||[],ae(t).constructor):n.apply(t,s))}function wt(t,n){if(n&&(V(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Dt(t)}function Dt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ce(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ce=function(){return!!t})()}function ae(t){return ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},ae(t)}function Nt(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&ue(t,n)}function ue(t,n){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,r){return a.__proto__=r,a},ue(t,n)}function F(t,n,s){return n=Fe(n),n in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,t}function Fe(t){var n=kt(t,"string");return V(n)=="symbol"?n:n+""}function kt(t,n){if(V(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,n);if(V(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var q=function(t){function n(){var s;bt(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return s=Tt(this,n,[].concat(r)),F(s,"state",{isAnimationFinished:!0,totalLength:0}),F(s,"generateSimpleStrokeDasharray",function(i,l){return"".concat(l,"px ").concat(i-l,"px")}),F(s,"getStrokeDasharray",function(i,l,c){var m=c.reduce(function(b,S){return b+S});if(!m)return s.generateSimpleStrokeDasharray(l,i);for(var f=Math.floor(i/m),x=i%m,g=l-i,j=[],u=0,d=0;u<c.length;d+=c[u],++u)if(d+c[u]>x){j=[].concat(U(c.slice(0,u)),[x-d]);break}var h=j.length%2===0?[0,g]:[g];return[].concat(U(n.repeat(c,f)),U(j),h).map(function(b){return"".concat(b,"px")}).join(", ")}),F(s,"id",rt("recharts-line-")),F(s,"pathRef",function(i){s.mainCurve=i}),F(s,"handleAnimationEnd",function(){s.setState({isAnimationFinished:!0}),s.props.onAnimationEnd&&s.props.onAnimationEnd()}),F(s,"handleAnimationStart",function(){s.setState({isAnimationFinished:!1}),s.props.onAnimationStart&&s.props.onAnimationStart()}),s}return Nt(n,t),St(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var a=this.getTotalLength();this.setState({totalLength:a})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var a=this.getTotalLength();a!==this.state.totalLength&&this.setState({totalLength:a})}}},{key:"getTotalLength",value:function(){var a=this.mainCurve;try{return a&&a.getTotalLength&&a.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(a,r){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.points,l=o.xAxis,c=o.yAxis,m=o.layout,f=o.children,x=Xe(f,Je);if(!x)return null;var g=function(d,h){return{x:d.x,y:d.y,value:d.value,errorVal:Pe(d.payload,h)}},j={clipPath:a?"url(#clipPath-".concat(r,")"):null};return N.createElement(re,j,x.map(function(u){return N.cloneElement(u,{key:"bar-".concat(u.props.dataKey),data:i,xAxis:l,yAxis:c,layout:m,dataPointFormatter:g})}))}},{key:"renderDots",value:function(a,r,o){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.dot,m=l.points,f=l.dataKey,x=Z(this.props,!1),g=Z(c,!0),j=m.map(function(d,h){var b=A(A(A({key:"dot-".concat(h),r:3},x),g),{},{index:h,cx:d.x,cy:d.y,value:d.value,dataKey:f,payload:d.payload,points:m});return n.renderDotItem(c,b)}),u={clipPath:a?"url(#clipPath-".concat(r?"":"dots-").concat(o,")"):null};return N.createElement(re,X({className:"recharts-line-dots",key:"dots"},u),j)}},{key:"renderCurveStatically",value:function(a,r,o,i){var l=this.props,c=l.type,m=l.layout,f=l.connectNulls;l.ref;var x=Te(l,ht),g=A(A(A({},Z(x,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:r?"url(#clipPath-".concat(o,")"):null,points:a},i),{},{type:c,layout:m,connectNulls:f});return N.createElement(Ze,X({},g,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(a,r){var o=this,i=this.props,l=i.points,c=i.strokeDasharray,m=i.isAnimationActive,f=i.animationBegin,x=i.animationDuration,g=i.animationEasing,j=i.animationId,u=i.animateNewValues,d=i.width,h=i.height,b=this.state,S=b.prevPoints,I=b.totalLength;return N.createElement(et,{begin:f,duration:x,isActive:m,easing:g,from:{t:0},to:{t:1},key:"line-".concat(j),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(O){var D=O.t;if(S){var v=S.length/l.length,y=l.map(function(w,se){var K=Math.floor(se*v);if(S[K]){var Y=S[K],L=G(Y.x,w.x),Oe=G(Y.y,w.y);return A(A({},w),{},{x:L(D),y:Oe(D)})}if(u){var Ie=G(d*2,w.x),We=G(h/2,w.y);return A(A({},w),{},{x:Ie(D),y:We(D)})}return A(A({},w),{},{x:w.x,y:w.y})});return o.renderCurveStatically(y,a,r)}var p=G(0,I),T=p(D),k;if(c){var M="".concat(c).split(/[,\s]+/gim).map(function(w){return parseFloat(w)});k=o.getStrokeDasharray(T,I,M)}else k=o.generateSimpleStrokeDasharray(I,T);return o.renderCurveStatically(l,a,r,{strokeDasharray:k})})}},{key:"renderCurve",value:function(a,r){var o=this.props,i=o.points,l=o.isAnimationActive,c=this.state,m=c.prevPoints,f=c.totalLength;return l&&i&&i.length&&(!m&&f>0||!tt(m,i))?this.renderCurveWithAnimation(a,r):this.renderCurveStatically(i,a,r)}},{key:"render",value:function(){var a,r=this.props,o=r.hide,i=r.dot,l=r.points,c=r.className,m=r.xAxis,f=r.yAxis,x=r.top,g=r.left,j=r.width,u=r.height,d=r.isAnimationActive,h=r.id;if(o||!l||!l.length)return null;var b=this.state.isAnimationFinished,S=l.length===1,I=pe("recharts-line",c),O=m&&m.allowDataOverflow,D=f&&f.allowDataOverflow,v=O||D,y=ie(h)?this.id:h,p=(a=Z(i,!1))!==null&&a!==void 0?a:{r:3,strokeWidth:2},T=p.r,k=T===void 0?3:T,M=p.strokeWidth,w=M===void 0?2:M,se=at(i)?i:{},K=se.clipDot,Y=K===void 0?!0:K,L=k*2+w;return N.createElement(re,{className:I},O||D?N.createElement("defs",null,N.createElement("clipPath",{id:"clipPath-".concat(y)},N.createElement("rect",{x:O?g:g-j/2,y:D?x:x-u/2,width:O?j:j*2,height:D?u:u*2})),!Y&&N.createElement("clipPath",{id:"clipPath-dots-".concat(y)},N.createElement("rect",{x:g-L/2,y:x-L/2,width:j+L,height:u+L}))):null,!S&&this.renderCurve(v,y),this.renderErrorBar(v,y),(S||i)&&this.renderDots(v,Y,y),(!d||b)&&st.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(a,r){return a.animationId!==r.prevAnimationId?{prevAnimationId:a.animationId,curPoints:a.points,prevPoints:r.curPoints}:a.points!==r.curPoints?{curPoints:a.points}:null}},{key:"repeat",value:function(a,r){for(var o=a.length%2!==0?[].concat(U(a),[0]):a,i=[],l=0;l<r;++l)i=[].concat(U(i),U(o));return i}},{key:"renderDotItem",value:function(a,r){var o;if(N.isValidElement(a))o=N.cloneElement(a,r);else if(He(a))o=a(r);else{var i=r.key,l=Te(r,ft),c=pe("recharts-line-dot",typeof a!="boolean"?a.className:"");o=N.createElement(Ge,X({key:i},l,{className:c}))}return o}}])}(E.PureComponent);F(q,"displayName","Line");F(q,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!nt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});F(q,"getComposedData",function(t){var n=t.props,s=t.xAxis,a=t.yAxis,r=t.xAxisTicks,o=t.yAxisTicks,i=t.dataKey,l=t.bandSize,c=t.displayedData,m=t.offset,f=n.layout,x=c.map(function(g,j){var u=Pe(g,i);return f==="horizontal"?{x:ve({axis:s,ticks:r,bandSize:l,entry:g,index:j}),y:ie(u)?null:a.scale(u),value:u,payload:g}:{x:ie(u)?null:s.scale(u),y:ve({axis:a,ticks:o,bandSize:l,entry:g,index:j}),value:u,payload:g}});return A({points:x,layout:f},m)});var At=it({chartName:"LineChart",GraphicalChild:q,axisComponents:[{axisType:"xAxis",AxisComp:oe},{axisType:"yAxis",AxisComp:le}],formatAxisMap:ot});function Et(t,n=7){if(!t||t.length===0)return{averageDuration:0,averageQuality:0,averageTimeToSleep:0,averageWakeUps:0,sleepEfficiency:0,consistencyScore:0};const s=new Date;s.setDate(s.getDate()-n);const a=t.filter(d=>new Date(d.date)>=s);if(a.length===0)return{averageDuration:0,averageQuality:0,averageTimeToSleep:0,averageWakeUps:0,sleepEfficiency:0,consistencyScore:0};const r=a.reduce((d,h)=>d+h.sleepDuration,0),o=a.reduce((d,h)=>d+h.sleepQuality,0),i=a.reduce((d,h)=>d+h.timeToFallAsleep,0),l=a.reduce((d,h)=>d+h.timesWokenUp,0),c=r/a.length,m=o/a.length,f=i/a.length,x=l/a.length;let g=0;a.forEach(d=>{const h=Ct(d.bedTime,d.wakeTime),b=h>0?d.sleepDuration/h*100:0;g+=b});const j=g/a.length,u=Ft(a);return{averageDuration:Math.round(c*100)/100,averageQuality:Math.round(m*100)/100,averageTimeToSleep:Math.round(f),averageWakeUps:Math.round(x*100)/100,sleepEfficiency:Math.round(j),consistencyScore:Math.round(u)}}function Pt(t,n=7){const s=Et(t,n),a=[];return s.averageDuration<6?a.push({type:"warning",insight:"You're getting less than 6 hours of sleep on average",recommendation:"Aim for 7-9 hours for optimal recovery and performance"}):s.averageDuration<7?a.push({type:"info",insight:"Your sleep duration is below the recommended range",recommendation:"Consider getting more sleep. 7-9 hours is ideal for muscle recovery"}):s.averageDuration>9?a.push({type:"info",insight:"You might be oversleeping",recommendation:"7-9 hours is typically optimal for most adults"}):a.push({type:"positive",insight:"Great sleep duration!",recommendation:"You're getting an optimal amount of sleep for recovery"}),s.averageQuality<3?a.push({type:"warning",insight:"Your sleep quality is below average",recommendation:"Consider improving sleep hygiene or consulting a healthcare provider"}):s.averageQuality>=4&&a.push({type:"positive",insight:"Excellent sleep quality!",recommendation:"This supports great muscle recovery and performance"}),s.averageTimeToSleep>30&&a.push({type:"warning",insight:"It's taking you more than 30 minutes to fall asleep",recommendation:"Consider a bedtime routine or relaxation techniques"}),s.averageWakeUps>2&&a.push({type:"warning",insight:"You're waking up frequently during the night",recommendation:"This can impact recovery quality - consider sleep environment improvements"}),s.sleepEfficiency<85&&a.push({type:"info",insight:"Your sleep efficiency is below 85%",recommendation:"Try to limit time in bed to actual sleep time"}),s.consistencyScore<70&&a.push({type:"warning",insight:"Your sleep schedule varies significantly",recommendation:"Try to maintain consistent bed and wake times"}),a}function Ct(t,n){const[s,a]=t.split(":").map(Number),[r,o]=n.split(":").map(Number),i=s*60+a;let l=r*60+o;return l<i&&(l+=24*60),(l-i)/60}function Ft(t){if(t.length<2)return 100;const n=t.map(l=>Ne(l.sleepTime)),s=t.map(l=>Ne(l.wakeTime)),a=ke(n),r=ke(s),o=Math.max(0,100-a/60*50),i=Math.max(0,100-r/60*50);return(o+i)/2}function Ne(t){const[n,s]=t.split(":").map(Number);return n*60+s}function ke(t){if(t.length<2)return 0;const n=t.reduce((r,o)=>r+o,0)/t.length,a=t.map(r=>Math.pow(r-n,2)).reduce((r,o)=>r+o,0)/t.length;return Math.sqrt(a)}const B="Sleep_Log",de=Me()(_e((t,n)=>({sleepLogs:[],isLoading:!1,error:null,isDataFetched:!1,fetchSleepLogs:async(s=!1)=>{if(!(n().isDataFetched&&!s)){t({isLoading:!0,error:null});try{const r=await Ue(B);if(r.success&&r.data){const o=r.data.map((i,l)=>({id:String(i.ID||i.id||fe()),date:String(i.Date||i.date||""),bedTime:String(i.BedTime||i.bedTime||""),sleepTime:String(i.SleepTime||i.sleepTime||""),wakeTime:String(i.WakeTime||i.wakeTime||""),sleepDuration:parseFloat(String(i.SleepDuration||i.sleepDuration||"0"))||0,sleepQuality:parseInt(String(i.SleepQuality||i.sleepQuality||"1"))||1,timeToFallAsleep:parseInt(String(i.TimeToFallAsleep||i.timeToFallAsleep||"0"))||0,timesWokenUp:parseInt(String(i.TimesWokenUp||i.timesWokenUp||"0"))||0,sleepNotes:String(i.SleepNotes||i.sleepNotes||""),rowIndex:l+2,isSynced:!0,pendingAction:null}));t({sleepLogs:o,isLoading:!1,isDataFetched:!0})}else throw new Error(r.error||"Failed to fetch sleep logs")}catch(r){console.error("Error fetching sleep logs:",r),t({error:r instanceof Error?r.message:"Failed to fetch sleep logs",isLoading:!1})}}},addSleepLog:async s=>{const a={...s,id:fe(),isSynced:!1,pendingAction:"add"};t(r=>({sleepLogs:[...r.sleepLogs,a],error:null}));try{const r={ID:a.id,Date:a.date,BedTime:a.bedTime,SleepTime:a.sleepTime,WakeTime:a.wakeTime,SleepDuration:a.sleepDuration.toString(),SleepQuality:a.sleepQuality.toString(),TimeToFallAsleep:a.timeToFallAsleep.toString(),TimesWokenUp:a.timesWokenUp.toString(),SleepNotes:a.sleepNotes||""};return(await me(B,r)).success&&t(i=>({sleepLogs:i.sleepLogs.map(l=>l.id===a.id?{...l,isSynced:!0,pendingAction:null}:l)})),a}catch(r){return console.error("Error syncing new sleep log:",r),a}},editSleepLog:async s=>{t(a=>({sleepLogs:a.sleepLogs.map(r=>r.id===s.id?{...s,isSynced:!1,pendingAction:"update"}:r),error:null}));try{if(s.rowIndex){const a={ID:s.id,Date:s.date,BedTime:s.bedTime,SleepTime:s.sleepTime,WakeTime:s.wakeTime,SleepDuration:s.sleepDuration.toString(),SleepQuality:s.sleepQuality.toString(),TimeToFallAsleep:s.timeToFallAsleep.toString(),TimesWokenUp:s.timesWokenUp.toString(),SleepNotes:s.sleepNotes||""};(await he(B,s.rowIndex,a)).success&&t(o=>({sleepLogs:o.sleepLogs.map(i=>i.id===s.id?{...i,isSynced:!0,pendingAction:null}:i)}))}}catch(a){console.error("Error syncing updated sleep log:",a)}},removeSleepLog:async s=>{const r=n().sleepLogs.find(o=>o.id===s);t(o=>({sleepLogs:o.sleepLogs.filter(i=>i.id!==s),error:null}));try{r!=null&&r.rowIndex&&await Le(B,r.rowIndex)}catch(o){console.error("Error syncing sleep log deletion:",o)}},syncPendingSleepLogs:async()=>{const a=n().sleepLogs.filter(r=>!r.isSynced);if(a.length!==0){t({isLoading:!0});try{for(const r of a){const o={ID:r.id,Date:r.date,BedTime:r.bedTime,SleepTime:r.sleepTime,WakeTime:r.wakeTime,SleepDuration:r.sleepDuration.toString(),SleepQuality:r.sleepQuality.toString(),TimeToFallAsleep:r.timeToFallAsleep.toString(),TimesWokenUp:r.timesWokenUp.toString(),SleepNotes:r.sleepNotes||""};r.pendingAction==="add"?(await me(B,o)).success&&t(l=>({sleepLogs:l.sleepLogs.map(c=>c.id===r.id?{...c,isSynced:!0,pendingAction:null}:c)})):r.pendingAction==="update"&&r.rowIndex&&(await he(B,r.rowIndex,o)).success&&t(l=>({sleepLogs:l.sleepLogs.map(c=>c.id===r.id?{...c,isSynced:!0,pendingAction:null}:c)}))}}catch(r){console.error("Error syncing pending sleep logs:",r),t({error:"Failed to sync pending changes"})}finally{t({isLoading:!1})}}},getSleepMetrics:(s=7)=>{const r=n().sleepLogs;if(!r||r.length===0)return{averageDuration:0,averageQuality:0,averageTimeToSleep:0,averageWakeUps:0,sleepEfficiency:0,consistencyScore:0};const o=new Date;o.setDate(o.getDate()-s);const i=r.filter(v=>new Date(v.date)>=o);if(i.length===0)return{averageDuration:0,averageQuality:0,averageTimeToSleep:0,averageWakeUps:0,sleepEfficiency:0,consistencyScore:0};const l=i.reduce((v,y)=>v+y.sleepDuration,0),c=i.reduce((v,y)=>v+y.sleepQuality,0),m=i.reduce((v,y)=>v+y.timeToFallAsleep,0),f=i.reduce((v,y)=>v+y.timesWokenUp,0),x=l/i.length,g=c/i.length,j=m/i.length,u=f/i.length;let d=0;i.forEach(v=>{const y=new Date(`1970-01-01T${v.bedTime}:00`),p=new Date(`1970-01-01T${v.wakeTime}:00`);p<y&&p.setDate(p.getDate()+1);const T=(p.getTime()-y.getTime())/(1e3*60*60),k=T>0?v.sleepDuration/T*100:0;d+=k});const h=d/i.length,b=i.map(v=>{const y=new Date(`1970-01-01T${v.bedTime}:00`);return y.getHours()+y.getMinutes()/60}),S=i.map(v=>{const y=new Date(`1970-01-01T${v.wakeTime}:00`);return y.getHours()+y.getMinutes()/60}),I=b.reduce((v,y)=>{const p=b.reduce((T,k)=>T+k,0)/b.length;return v+Math.pow(y-p,2)},0)/b.length,O=S.reduce((v,y)=>{const p=S.reduce((T,k)=>T+k,0)/S.length;return v+Math.pow(y-p,2)},0)/S.length,D=Math.max(0,100-(I+O)*10);return{averageDuration:Math.round(x*100)/100,averageQuality:Math.round(g*100)/100,averageTimeToSleep:Math.round(j),averageWakeUps:Math.round(u*100)/100,sleepEfficiency:Math.round(h*100)/100,consistencyScore:Math.round(D*100)/100}}}),{name:"sleep-logs-store",storage:Qe(()=>localStorage),partialize:t=>({sleepLogs:t.sleepLogs,isDataFetched:t.isDataFetched})}));function Ot({className:t,...n}){return e.jsx("textarea",{"data-slot":"textarea",className:Be("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...n})}const It=({editingLog:t=null,onClose:n,onSuccess:s})=>{const{addSleepLog:a,editSleepLog:r}=de(),[o,i]=E.useState({date:(t==null?void 0:t.date)||new Date().toISOString().split("T")[0],bedTime:(t==null?void 0:t.bedTime)||"22:00",sleepTime:(t==null?void 0:t.sleepTime)||"22:30",wakeTime:(t==null?void 0:t.wakeTime)||"07:00",sleepDuration:(t==null?void 0:t.sleepDuration)||8,sleepQuality:(t==null?void 0:t.sleepQuality)||3,timeToFallAsleep:(t==null?void 0:t.timeToFallAsleep)||30,timesWokenUp:(t==null?void 0:t.timesWokenUp)||1,sleepNotes:(t==null?void 0:t.sleepNotes)||""}),[l,c]=E.useState(!1),m=(u,d)=>{i(h=>({...h,[u]:d}))},f=(u,d)=>{const h=new Date(`1970-01-01T${u}:00`),b=new Date(`1970-01-01T${d}:00`);b<h&&b.setDate(b.getDate()+1);const S=b.getTime()-h.getTime();return Math.round(S/(1e3*60*60)*100)/100},x=(u,d)=>{const h={...o,[u]:d};(u==="bedTime"||u==="wakeTime")&&(h.sleepDuration=f(u==="bedTime"?d:o.bedTime,u==="wakeTime"?d:o.wakeTime)),i(h)},g=async u=>{u.preventDefault(),c(!0);try{t?await r({...t,...o}):await a(o),s==null||s(),n==null||n()}catch(d){console.error("Error saving sleep log:",d)}finally{c(!1)}},j=u=>["Very Poor","Poor","Fair","Good","Excellent"][u-1]||"Fair";return e.jsxs(P,{className:"w-full max-w-2xl mx-auto",children:[e.jsx(ee,{children:e.jsxs(te,{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 mr-2 text-blue-500"}),t?"Edit Sleep Log":"Log Sleep"]})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"date",children:"Date"}),e.jsx(_,{id:"date",type:"date",value:o.date,onChange:u=>m("date",u.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"bedTime",children:"Bedtime"}),e.jsx(_,{id:"bedTime",type:"time",value:o.bedTime,onChange:u=>x("bedTime",u.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"sleepTime",children:"Sleep Time"}),e.jsx(_,{id:"sleepTime",type:"time",value:o.sleepTime,onChange:u=>x("sleepTime",u.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"wakeTime",children:"Wake Time"}),e.jsx(_,{id:"wakeTime",type:"time",value:o.wakeTime,onChange:u=>x("wakeTime",u.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"sleepDuration",children:"Sleep Duration (hours)"}),e.jsx(_,{id:"sleepDuration",type:"number",step:"0.1",min:"0",max:"24",value:o.sleepDuration,onChange:u=>m("sleepDuration",parseFloat(u.target.value)||0),required:!0})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(W,{children:["Sleep Quality: ",j(o.sleepQuality)]}),e.jsx(ze,{value:[o.sleepQuality],onValueChange:u=>m("sleepQuality",u[0]),min:1,max:5,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Very Poor"}),e.jsx("span",{children:"Poor"}),e.jsx("span",{children:"Fair"}),e.jsx("span",{children:"Good"}),e.jsx("span",{children:"Excellent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"timeToFallAsleep",children:"Time to Fall Asleep (minutes)"}),e.jsx(_,{id:"timeToFallAsleep",type:"number",min:"0",max:"300",value:o.timeToFallAsleep,onChange:u=>m("timeToFallAsleep",parseInt(u.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"timesWokenUp",children:"Times Woken Up"}),e.jsx(_,{id:"timesWokenUp",type:"number",min:"0",max:"20",value:o.timesWokenUp,onChange:u=>m("timesWokenUp",parseInt(u.target.value)||0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"sleepNotes",children:"Sleep Notes (optional)"}),e.jsx(Ot,{id:"sleepNotes",placeholder:"How did you sleep? Any factors affecting your sleep...",value:o.sleepNotes,onChange:u=>m("sleepNotes",u.target.value),rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs($,{type:"submit",disabled:l,className:"flex-1",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),l?"Saving...":t?"Update Sleep Log":"Save Sleep Log"]}),n&&e.jsxs($,{type:"button",variant:"outline",onClick:n,children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})})]})},Wt=({daysToShow:t=14})=>{const{sleepLogs:n,getSleepMetrics:s}=de(),a=E.useMemo(()=>s(7),[s]),r=E.useMemo(()=>{const l=new Date;return l.setDate(l.getDate()-t),n.filter(c=>new Date(c.date)>=l).sort((c,m)=>new Date(c.date).getTime()-new Date(m.date).getTime()).map(c=>{const m=new Date(`1970-01-01T${c.bedTime}:00`),f=new Date(`1970-01-01T${c.wakeTime}:00`);f<m&&f.setDate(f.getDate()+1);const x=(f.getTime()-m.getTime())/(1e3*60*60),g=x>0?c.sleepDuration/x*100:0;return{...c,displayDate:new Date(c.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),efficiency:g}})},[n,t]),o=E.useMemo(()=>Pt(n),[n]),i=l=>l>=4?"text-green-500":l>=3?"text-yellow-500":"text-red-500";return!n||n.length===0?e.jsxs(P,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 mr-2 text-blue-500"}),"Sleep Analytics"]}),e.jsx(ne,{children:"Start logging your sleep to see analytics and insights"})]}),e.jsxs(C,{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No sleep data available"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(P,{children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Duration"}),e.jsxs("p",{className:"text-lg font-semibold",children:[a.averageDuration.toFixed(1),"h"]})]}),e.jsx(Ve,{className:"h-4 w-4 text-blue-500"})]}),e.jsx(J,{value:a.averageDuration/9*100,className:"h-1 mt-2"})]})}),e.jsx(P,{children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Quality"}),e.jsxs("p",{className:`text-lg font-semibold ${i(a.averageQuality)}`,children:[a.averageQuality.toFixed(1),"/5"]})]}),e.jsx(qe,{className:"h-4 w-4 text-green-500"})]}),e.jsx(J,{value:a.averageQuality/5*100,className:"h-1 mt-2"})]})}),e.jsx(P,{children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sleep Efficiency"}),e.jsxs("p",{className:"text-lg font-semibold",children:[a.sleepEfficiency.toFixed(0),"%"]})]}),e.jsx(xe,{className:"h-4 w-4 text-purple-500"})]}),e.jsx(J,{value:a.sleepEfficiency,className:"h-1 mt-2"})]})}),e.jsx(P,{children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Consistency"}),e.jsxs("p",{className:"text-lg font-semibold",children:[a.consistencyScore.toFixed(0),"%"]})]}),e.jsx(ge,{className:"h-4 w-4 text-orange-500"})]}),e.jsx(J,{value:a.consistencyScore,className:"h-1 mt-2"})]})})]}),e.jsxs(P,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Sleep Analytics"}),e.jsx(ne,{children:"Track your sleep patterns and recovery over time"})]}),e.jsx(C,{children:e.jsxs(Ae,{defaultValue:"trends",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-3",children:[e.jsx(z,{value:"trends",children:"Sleep Trends"}),e.jsx(z,{value:"quality",children:"Quality Analysis"}),e.jsx(z,{value:"insights",children:"Insights"})]}),e.jsxs(R,{value:"trends",className:"space-y-4",children:[e.jsx("div",{className:"h-64",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(At,{data:r,children:[e.jsx(be,{strokeDasharray:"3 3",opacity:.2}),e.jsx(oe,{dataKey:"displayDate",fontSize:12,tick:{fontSize:10}}),e.jsx(le,{fontSize:12,tick:{fontSize:10}}),e.jsx(Se,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px"},formatter:(l,c)=>[c==="sleepDuration"?`${l.toFixed(1)}h`:c==="sleepQuality"?`${l}/5`:`${l.toFixed(0)}%`,c==="sleepDuration"?"Duration":c==="sleepQuality"?"Quality":"Efficiency"]}),e.jsx(q,{type:"monotone",dataKey:"sleepDuration",stroke:"#3b82f6",strokeWidth:2,dot:{r:3},name:"sleepDuration"}),e.jsx(q,{type:"monotone",dataKey:"efficiency",stroke:"#8b5cf6",strokeWidth:2,dot:{r:3},name:"efficiency"})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),e.jsx("span",{children:"Sleep Duration"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full mr-2"}),e.jsx("span",{children:"Sleep Efficiency"})]})]})]}),e.jsxs(R,{value:"quality",className:"space-y-4",children:[e.jsx("div",{className:"h-64",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(lt,{data:r,children:[e.jsx(be,{strokeDasharray:"3 3",opacity:.2}),e.jsx(oe,{dataKey:"displayDate",fontSize:12,tick:{fontSize:10}}),e.jsx(le,{domain:[0,5],fontSize:12,tick:{fontSize:10}}),e.jsx(Se,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px"},formatter:l=>[`${l}/5`,"Quality"]}),e.jsx(ct,{dataKey:"sleepQuality",fill:"#10b981",radius:[2,2,0,0]})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Time to Fall Asleep"}),e.jsxs("p",{className:"font-medium",children:[a.averageTimeToSleep," min"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Average Wake-ups"}),e.jsx("p",{className:"font-medium",children:a.averageWakeUps.toFixed(1)})]})]})]}),e.jsx(R,{value:"insights",className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[o.map((l,c)=>e.jsx("div",{className:`p-3 rounded-lg border-l-4 ${l.type==="positive"?"bg-green-50 border-green-500 dark:bg-green-950":l.type==="warning"?"bg-yellow-50 border-yellow-500 dark:bg-yellow-950":"bg-blue-50 border-blue-500 dark:bg-blue-950"}`,children:e.jsxs("div",{className:"flex items-start",children:[l.type==="positive"?e.jsx(ge,{className:"h-4 w-4 text-green-500 mt-0.5 mr-2 flex-shrink-0"}):l.type==="warning"?e.jsx(ut,{className:"h-4 w-4 text-yellow-500 mt-0.5 mr-2 flex-shrink-0"}):e.jsx(xe,{className:"h-4 w-4 text-blue-500 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:l.insight}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:l.recommendation})]})]})},c)),o.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Log more sleep data to get personalized insights"})]})]})})]})})]})]})},Mt=()=>{const{appStore:t}=$e(),{setCurrentView:n}=t,{sleepLogs:s,fetchSleepLogs:a,removeSleepLog:r,isLoading:o,error:i}=de(),[l,c]=E.useState(!1),[m,f]=E.useState(null),[x,g]=E.useState(""),[j,u]=E.useState("7"),[d,h]=E.useState(new Date().toISOString().split("T")[0]);E.useEffect(()=>{a()},[a]);const b=s.filter(p=>{const T=x===""||p.date.includes(x)||p.sleepNotes&&p.sleepNotes.toLowerCase().includes(x.toLowerCase()),k=new Date(p.date),M=new Date;M.setDate(M.getDate()-parseInt(j));const w=j==="all"||k>=M;return T&&w}).sort((p,T)=>new Date(T.date).getTime()-new Date(p.date).getTime()),S=p=>{f(p),c(!0)},I=async p=>{window.confirm("Are you sure you want to delete this sleep log?")&&await r(p)},O=()=>{c(!1),f(null)},D=()=>{c(!1),f(null),a(!0)},v=p=>p>=4?e.jsx(H,{className:"bg-green-500/10 text-green-500",children:"Excellent"}):p>=3?e.jsx(H,{className:"bg-blue-500/10 text-blue-500",children:"Good"}):p>=2?e.jsx(H,{className:"bg-yellow-500/10 text-yellow-500",children:"Fair"}):e.jsx(H,{className:"bg-red-500/10 text-red-500",children:"Poor"}),y=p=>new Date(`1970-01-01T${p}:00`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return l?e.jsx("div",{className:"container max-w-4xl mx-auto py-4 px-2 sm:px-4",children:e.jsx(It,{editingLog:m,onClose:O,onSuccess:D})}):e.jsxs("div",{className:"container max-w-6xl mx-auto py-2 sm:py-4 px-2 sm:px-4 min-h-[80vh]",children:[e.jsx(dt,{icon:Q,title:"Sleep Tracking",date:d,onDateChange:h,action:e.jsxs($,{onClick:()=>c(!0),"aria-label":"Log Sleep",children:[e.jsx(ye,{className:"h-4 w-4"})," Log Sleep"]})}),i&&e.jsx(P,{className:"mb-4 border-red-200 bg-red-50 dark:bg-red-950",children:e.jsx(C,{className:"pt-4",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:i})})}),e.jsxs(Ae,{defaultValue:"analytics",className:"space-y-4",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-3",children:[e.jsx(z,{value:"analytics",className:"text-xs sm:text-sm",children:"Analytics"}),e.jsx(z,{value:"logs",className:"text-xs sm:text-sm",children:"Sleep Logs"}),e.jsx(z,{value:"recovery",className:"text-xs sm:text-sm",children:"Recovery Impact"})]}),e.jsx(R,{value:"analytics",children:e.jsx(Wt,{})}),e.jsx(R,{value:"logs",className:"space-y-4",children:o?e.jsx(P,{children:e.jsx(C,{className:"py-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading sleep logs..."})})}):b.length===0?e.jsx(P,{children:e.jsxs(C,{className:"py-8 text-center",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s.length===0?"No sleep logs yet. Start tracking your sleep!":"No sleep logs match your current filters."}),s.length===0&&e.jsxs($,{onClick:()=>c(!0),className:"focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Log Your First Sleep",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Log Your First Sleep"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:b.map(p=>e.jsx(P,{className:"hover:shadow-md transition-shadow",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-medium text-sm sm:text-base",children:new Date(p.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}),v(p.sleepQuality),!p.isSynced&&e.jsx(H,{variant:"outline",className:"text-orange-500 text-xs sm:text-sm",children:"Pending Sync"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs sm:text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Bedtime"}),e.jsx("p",{className:"font-medium",children:y(p.bedTime)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Wake Time"}),e.jsx("p",{className:"font-medium",children:y(p.wakeTime)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Duration"}),e.jsxs("p",{className:"font-medium",children:[p.sleepDuration,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Time to Sleep"}),e.jsxs("p",{className:"font-medium",children:[p.timeToFallAsleep,"m"]})]})]}),p.sleepNotes&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Notes:"})," ",p.sleepNotes]})}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>S(p),className:"focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Edit Sleep Log",children:e.jsx(pt,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>I(p.id),className:"focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Delete Sleep Log",children:e.jsx(mt,{className:"h-4 w-4"})})]})]})})},p.id))})}),e.jsx(R,{value:"recovery",children:e.jsxs(P,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Sleep & Recovery Integration"}),e.jsx(ne,{children:"How your sleep affects muscle recovery and training readiness"})]}),e.jsx(C,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Sleep recovery integration with muscle fatigue analysis coming soon!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will show how your sleep quality affects your training recovery."}),"              "]})})]})})]})]})};function _t(){return e.jsx(Ke,{children:e.jsx(Mt,{})})}const Ht=Object.freeze(Object.defineProperty({__proto__:null,default:_t},Symbol.toStringTag,{value:"Module"}));export{_t as S,Ot as T,Ht as a};
//# sourceMappingURL=SleepTrackingPage-nf6Tifin.js.map
