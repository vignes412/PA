import{j as e,c as ge,b as ve,r as n,B as i}from"./pwa-components-CT9i-ezC.js";import{u as Ne,x as Ce,D as we,z as be}from"./index-q3-Wd2Xo.js";import{u as Se,C as V,B as R,a as T,P as W}from"./progress-Bg--TRTd.js";import{c as ke,C as D,d as A}from"./index-Bu_9SX0w.js";import{D as $,a as O,b as z,c as L,e as I,I as X,d as P}from"./dialog-CBq_T2rE.js";import{L as B}from"./label-SZsfCIDt.js";import{S as ye}from"./scroll-area-cY-r7eXx.js";import{u as Ee,S as Re}from"./use-toast-wIonZgBj.js";import{S as Te}from"./save-B-oo1lNA.js";import"./db-utils-DgoSxAK8.js";import"./react-vendor-Csw2ODfV.js";import"./gapiScript-D2rOjFaT.js";/**
 * @license lucide-react v0.509.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],De=ke("arrow-left",We);function Z({className:t,...w}){return e.jsx("textarea",{"data-slot":"textarea",className:ge("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...w})}const Ge=()=>{var U;const{activeWorkout:t,updateExerciseProgress:w,updateActiveWorkout:b,completeWorkout:ee,addExerciseSet:se}=Ne(),{addWorkoutLog:te}=Se(),h=ve(),{toast:d}=Ee(),[M,F]=n.useState(""),[o,p]=n.useState(null),[re,f]=n.useState(!1),[ae,S]=n.useState(!1),[j,H]=n.useState(!1),[_,G]=n.useState(null),[l,ne]=n.useState(null),[Y,q]=n.useState(""),[ie,g]=n.useState(!1),[v,k]=n.useState(0),[N,y]=n.useState(0),[J,K]=n.useState(3),E=60,oe=90;n.useEffect(()=>{if(!t)h.push("/");else{F(t.notes||"");const s=t.exercises.findIndex(r=>(r.setsCompleted||0)<r.sets);s!==-1&&p(s)}},[t,h]),n.useEffect(()=>{l&&(k(l.weight||0),y(l.reps||0))},[l]);const le=()=>{if(!t)return"00:00";const s=new Date(t.startTime),a=new Date().getTime()-s.getTime(),c=Math.floor(a/1e3/60),u=Math.floor(c/60),m=c%60;return`${u>0?`${u}h `:""}${m<10?"0":""}${m}m`},ce=()=>{if(!j||!_)return"00:00";const s=Date.now(),r=Math.floor((s-_)/1e3),a=Math.floor(r/60),c=r%60;return`${a}:${c<10?"0":""}${c}`},Q=(s=E)=>{G(Date.now()),H(!0),d({title:"Rest Timer Started",description:`${s} seconds rest timer started`})},de=()=>{H(!1),G(null)},me=()=>{de(),d({title:"Rest Timer Stopped",description:"Rest timer has been stopped"})},C=()=>{if(!t||!t.exercises)return 0;let s=0,r=0;return t.exercises.forEach(a=>{s+=a.sets,r+=a.setsCompleted||0}),s===0?0:Math.round(r/s*100)},ue=s=>{if(!t)return;const r=t.exercises[s];(r.setsCompleted||0)<r.sets&&(p(s),k(r.weight||0),y(r.reps||0),K(3),ne({...r,index:s}),f(!0))},xe=async()=>{if(!t||o===null||!l)return;const s=t.exercises[o],r=s.setsCompleted||0;if(r<s.sets){w(o,r+1);try{if(await te({date:new Date().toISOString(),muscleGroup:s.muscleGroup,exercise:s.name,reps:N,weight:v,rating:J,restTime:s.rest||E}),v!==s.weight||N!==s.reps){const a=[...t.exercises];a[o]={...a[o],weight:v,reps:N},b({exercises:a})}d({title:"Set Completed",description:`${s.name} set ${r+1}/${s.sets} logged`,variant:"success"})}catch(a){d({title:"Error",description:"Failed to log workout set. Will try again when online.",variant:"destructive"}),console.error("Error logging workout set:",a)}if(f(!1),Q(s.rest||E),r+1>=s.sets){const a=t.exercises.findIndex((c,u)=>u>o&&(c.setsCompleted||0)<c.sets);a!==-1?(Q(oe),p(a)):d({title:"Workout Complete",description:"All exercises have been completed! You can finish your workout.",variant:"success"})}}},he=()=>{if(!t||o===null)return;const s=[...t.exercises];s[o]={...s[o],notes:Y},b({exercises:s}),g(!1),d({title:"Notes Saved",description:"Exercise notes have been updated."})},pe=()=>{t&&(b({notes:M}),d({title:"Notes Saved",description:"Workout notes have been updated."}))},fe=async()=>{if(!t)return;const s=await ee();s.success?(d({title:"Workout Completed",description:"Your workout has been saved.",variant:"success"}),h.push("/")):d({title:"Error",description:s.error||"Failed to complete workout",variant:"destructive"})},je=s=>{t&&(se(s),d({title:"Set Added",description:`Added an extra set to ${t.exercises[s].name}`}))};return n.useEffect(()=>{let s=null;return j&&(s=setInterval(()=>{},1e3)),()=>{s&&clearInterval(s)}},[j]),t?e.jsxs(Ce,{children:[e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>h.push("/"),children:e.jsx(De,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold ml-2",children:"Active Workout"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(V,{className:"h-4 w-4 mr-1 text-muted-foreground"}),e.jsx("span",{children:le()})]}),j&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{variant:"outline",className:"bg-primary/10 text-primary flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),"Rest: ",ce()]}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:me,children:"Stop"})]}),e.jsxs(i,{variant:"default",size:"sm",onClick:()=>S(!0),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Finish Workout"]})]})]}),e.jsx(D,{className:"mb-6",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:t.templateName}),e.jsx("p",{className:"text-muted-foreground",children:t.description})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Overall Progress:"}),e.jsxs("span",{className:"font-medium",children:[C(),"%"]})]}),e.jsx(W,{value:C(),className:"w-40"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"mb-4 flex justify-between items-center",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Exercises"})}),e.jsx(ye,{className:"h-[calc(100vh-300px)]",children:e.jsx("div",{className:"space-y-4 pr-4",children:t.exercises.map((s,r)=>{const a=(s.setsCompleted||0)>=s.sets,c=r===o;return e.jsx(D,{className:`${c?"border-primary/50 bg-primary/5":a?"border-muted bg-muted/20":""}`,children:e.jsxs(A,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:`h-4 w-4 ${c?"text-primary":"text-muted-foreground"}`}),e.jsx("h3",{className:"font-medium text-lg",children:s.name})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.sets," sets Ã— ",s.reps," reps",s.weight>0&&` @ ${s.weight}`]})]}),e.jsxs(R,{children:[s.setsCompleted||0,"/",s.sets," Sets"]})]}),e.jsx(W,{value:(s.setsCompleted||0)/s.sets*100,className:"h-1.5 mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Array.from({length:s.sets}).map((u,m)=>{const x=(s.setsCompleted||0)>m;return e.jsxs(i,{size:"sm",variant:x?"default":"outline",className:x?"opacity-70":"",onClick:()=>!x&&ue(r),disabled:x,children:[x?e.jsx(T,{className:"h-3.5 w-3.5 mr-1"}):null,"Set ",m+1]},m)}),a&&e.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>je(r),children:[e.jsx(be,{className:"h-3.5 w-3.5 mr-1"}),"Extra Set"]})]}),s.notes?e.jsxs("div",{className:"mt-3 text-sm p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]}):e.jsxs(i,{size:"sm",variant:"ghost",className:"mt-2 text-xs",onClick:()=>{p(r),q(s.notes||""),g(!0)},children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"Add Notes"]})]})},r)})})})]}),e.jsx("div",{children:e.jsx(D,{className:"sticky top-4",children:e.jsxs(A,{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Workout Notes"}),e.jsx(Z,{placeholder:"Add notes about your workout here...",value:M,onChange:s=>F(s.target.value),className:"min-h-[150px] mb-4"}),e.jsxs(i,{onClick:pe,className:"w-full",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Save Notes"]})]})})})]})]}),e.jsx($,{open:re,onOpenChange:f,children:e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Log Exercise Set"}),e.jsxs(I,{children:["Record details for ",l==null?void 0:l.name," - Set ",((l==null?void 0:l.setsCompleted)||0)+1]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"weight",children:"Weight"}),e.jsx(X,{id:"weight",type:"number",min:0,value:v,onChange:s=>k(Number(s.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"reps",children:"Reps"}),e.jsx(X,{id:"reps",type:"number",min:0,value:N,onChange:s=>y(Number(s.target.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Rating (How difficult was this set?)"}),e.jsx("div",{className:"flex justify-between pt-2",children:[1,2,3,4,5].map(s=>e.jsxs(i,{type:"button",variant:J===s?"default":"outline",size:"sm",onClick:()=>K(s),className:"px-3",children:[s,s===1&&" - Easy",s===3&&" - Normal",s===5&&" - Hard"]},s))})]})]}),e.jsxs(P,{children:[e.jsx(i,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(i,{onClick:xe,children:"Save"})]})]})}),e.jsx($,{open:ie,onOpenChange:g,children:e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Exercise Notes"}),e.jsxs(I,{children:["Add notes for ",o!==null?(U=t.exercises[o])==null?void 0:U.name:""]})]}),e.jsx("div",{className:"py-4",children:e.jsx(Z,{placeholder:"Add notes about this exercise (form, modifications, etc.)...",value:Y,onChange:s=>q(s.target.value),className:"min-h-[150px]"})}),e.jsxs(P,{children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(i,{onClick:he,children:"Save Notes"})]})]})}),e.jsx($,{open:ae,onOpenChange:S,children:e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Complete Workout?"}),e.jsx(I,{children:"Are you sure you want to finish this workout? This action will save your progress."})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{children:"Progress:"}),e.jsxs(R,{children:[C(),"% Complete"]})]}),e.jsx(W,{value:C()})]}),e.jsxs(P,{children:[e.jsx(i,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsxs(i,{onClick:fe,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Complete Workout"]})]})]})})]}):e.jsx("div",{className:"flex justify-center items-center h-full",children:"Loading workout..."})};export{Ge as default};
//# sourceMappingURL=ActiveWorkoutPage-3SPOnMhP.js.map
