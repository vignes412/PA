import{j as e,c as Ce,b as we,r as a,B as i}from"./pwa-components-CT9i-ezC.js";import{u as be,x as Se,D as ke,z as ye}from"./index-Bw2eULof.js";import{u as Ee,C as Z,B as T,a as W,P as D}from"./progress-CPw95pJM.js";import{c as Re,C as A,d as $,t as c}from"./index-DiZ2WnTL.js";import{D as z,a as I,b as O,c as L,e as P,I as ee,d as B}from"./dialog-XNgzY81b.js";import{L as F}from"./label-BqmSm6DP.js";import{S as Te}from"./scroll-area-DBTwqpoX.js";import{S as We}from"./square-pen-S5LHHI64.js";import{S as De}from"./save-BywhBLcb.js";import"./db-utils-DgoSxAK8.js";import"./react-vendor-Csw2ODfV.js";import"./gapiScript-D2rOjFaT.js";/**
 * @license lucide-react v0.509.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],$e=Re("arrow-left",Ae);function se({className:r,...M}){return e.jsx("textarea",{"data-slot":"textarea",className:Ce("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),...M})}const Ve=()=>{var X;const{activeWorkout:r,updateExerciseProgress:M,updateActiveWorkout:C,completeWorkout:te,addExerciseSet:re}=be(),{addWorkoutLog:ae}=Ee(),h=we(),[H,_]=a.useState(""),[m,p]=a.useState(null),[ne,f]=a.useState(!1),[ie,w]=a.useState(!1),[j,G]=a.useState(!1),[Y,q]=a.useState(null),[o,oe]=a.useState(null),[U,V]=a.useState(""),[le,g]=a.useState(!1),[b,S]=a.useState(0),[k,y]=a.useState(0),[J,K]=a.useState(3),[E,Q]=a.useState(!1),[ze,Ie]=a.useState(0),v=60,ce=90;a.useEffect(()=>{if(!r)h.push("/");else{_(r.notes||"");const s=r.exercises.findIndex(t=>(t.setsCompleted||0)<t.sets);s!==-1&&p(s)}},[r,h]),a.useEffect(()=>{o&&(S(o.weight||0),y(o.reps||0))},[o]);const de=()=>{if(!r)return"00:00";const s=new Date(r.startTime),n=new Date().getTime()-s.getTime(),l=Math.floor(n/1e3/60),u=Math.floor(l/60),d=l%60;return`${u>0?`${u}h `:""}${d<10?"0":""}${d}m`},me=()=>{if(!j||!Y)return"00:00";const s=Date.now(),t=Math.floor((s-Y)/1e3),n=Math.floor(t/60),l=t%60;return`${n}:${l<10?"0":""}${l}`},R=(s=v)=>{q(Date.now()),G(!0),c("Rest Timer Started",{description:`${s} seconds rest timer started`})},ue=()=>{G(!1),q(null)},xe=()=>{ue(),c("Rest Timer Stopped",{description:"Rest timer has been stopped"})},N=()=>{if(!r||!r.exercises)return 0;let s=0,t=0;return r.exercises.forEach(n=>{s+=n.sets,t+=n.setsCompleted||0}),s===0?0:Math.round(t/s*100)},he=s=>{if(!r)return;const t=r.exercises[s];(t.setsCompleted||0)<t.sets&&(p(s),S(t.weight||0),y(t.reps||0),K(3),oe({...t,index:s}),f(!0))},pe=async()=>{if(!(!r||m===null||!o)){Q(!0);try{const s=o.index,t=r.exercises[s],n=t.setsCompleted||0;if(n<t.sets){const l=[...r.exercises];l[s]={...l[s],weight:b,reps:k,setsCompleted:n+1,percentComplete:(n+1)/t.sets*100},C({exercises:l});try{await ae({date:new Date().toISOString().split("T")[0],muscleGroup:t.muscleGroup,exercise:t.name,reps:k,weight:b,rating:J,restTime:t.rest||v}),c.success("Set Completed",{description:`${t.name} set ${n+1}/${t.sets} logged`})}catch{c.error("Error",{description:"Failed to log workout set. Will try again when online."}),c("Debug Info",{description:"Check network connectivity and try again"})}if(f(!1),n+1>=t.sets){const u=r.exercises.findIndex((d,x)=>x>s&&(d.setsCompleted||0)<d.sets);u!==-1?(R(ce),p(u)):(R(t.rest||v),c.success("Workout Complete",{description:"All exercises have been completed! You can finish your workout."}))}else R(t.rest||v)}}catch{c.error("Error",{description:"Failed to update exercise progress. Please try again."})}finally{Q(!1)}}},fe=()=>{if(!r||m===null)return;const s=[...r.exercises];s[m]={...s[m],notes:U},C({exercises:s}),g(!1),c("Notes Saved",{description:"Exercise notes have been updated."})},je=()=>{r&&(C({notes:H}),c("Notes Saved",{description:"Workout notes have been updated."}))},ge=async()=>{if(!r)return;const s=await te();s.success?(c.success("Workout Completed",{description:"Your workout has been saved."}),h.push("/")):c.error("Error",{description:s.error||"Failed to complete workout"})},ve=s=>{r&&(re(s),c("Set Added",{description:`Added an extra set to ${r.exercises[s].name}`}))};a.useEffect(()=>{let s=null;return j&&(s=setInterval(()=>{Ne({})},1e3)),()=>{s&&clearInterval(s)}},[j]);const[,Ne]=a.useState({});return r?e.jsxs(Se,{children:[e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>h.push("/"),children:e.jsx($e,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold ml-2",children:"Active Workout"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Z,{className:"h-4 w-4 mr-1 text-muted-foreground"}),e.jsx("span",{children:de()})]}),j&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{variant:"outline",className:"bg-primary/10 text-primary flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),"Rest: ",me()]}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:xe,children:"Stop"})]}),e.jsxs(i,{variant:"default",size:"sm",onClick:()=>w(!0),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Finish Workout"]})]})]}),e.jsx(A,{className:"mb-6",children:e.jsx($,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:r.templateName}),e.jsx("p",{className:"text-muted-foreground",children:r.description})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Overall Progress:"}),e.jsxs("span",{className:"font-medium",children:[N(),"%"]})]}),e.jsx(D,{value:N(),className:"w-40"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"mb-4 flex justify-between items-center",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Exercises"})}),e.jsx(Te,{className:"h-[calc(100vh-300px)]",children:e.jsx("div",{className:"space-y-4 pr-4",children:r.exercises.map((s,t)=>{const n=(s.setsCompleted||0)>=s.sets,l=t===m;return e.jsx(A,{className:`${l?"border-primary/50 bg-primary/5":n?"border-muted bg-muted/20":""}`,children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:`h-4 w-4 ${l?"text-primary":"text-muted-foreground"}`}),e.jsx("h3",{className:"font-medium text-lg",children:s.name})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.sets," sets Ã— ",s.reps," reps",s.weight>0&&` @ ${s.weight}`]})]}),e.jsxs(T,{children:[s.setsCompleted||0,"/",s.sets," Sets"]})]}),e.jsx(D,{value:(s.setsCompleted||0)/s.sets*100,className:"h-1.5 mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Array.from({length:s.sets}).map((u,d)=>{const x=(s.setsCompleted||0)>d;return e.jsxs(i,{size:"sm",variant:x?"default":"outline",className:x?"opacity-70":"",onClick:()=>!x&&he(t),disabled:x,children:[x?e.jsx(W,{className:"h-3.5 w-3.5 mr-1"}):null,"Set ",d+1]},d)}),n&&e.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>ve(t),children:[e.jsx(ye,{className:"h-3.5 w-3.5 mr-1"}),"Extra Set"]})]}),s.notes?e.jsxs("div",{className:"mt-3 text-sm p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]}):e.jsxs(i,{size:"sm",variant:"ghost",className:"mt-2 text-xs",onClick:()=>{p(t),V(s.notes||""),g(!0)},children:[e.jsx(We,{className:"h-3 w-3 mr-1"}),"Add Notes"]})]})},t)})})})]}),e.jsx("div",{children:e.jsx(A,{className:"sticky top-4",children:e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Workout Notes"}),e.jsx(se,{placeholder:"Add notes about your workout here...",value:H,onChange:s=>_(s.target.value),className:"min-h-[150px] mb-4"}),e.jsxs(i,{onClick:je,className:"w-full",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Save Notes"]})]})})})]})]}),e.jsx(z,{open:ne,onOpenChange:f,children:e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsx(L,{children:"Log Exercise Set"}),e.jsxs(P,{children:["Record details for ",o==null?void 0:o.name," - Set ",((o==null?void 0:o.setsCompleted)||0)+1]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"weight",children:"Weight"}),e.jsx(ee,{id:"weight",type:"number",min:0,value:b,onChange:s=>S(Number(s.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"reps",children:"Reps"}),e.jsx(ee,{id:"reps",type:"number",min:0,value:k,onChange:s=>y(Number(s.target.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Rating (How difficult was this set?)"}),e.jsx("div",{className:"flex justify-between pt-2",children:[1,2,3,4,5].map(s=>e.jsxs(i,{type:"button",variant:J===s?"default":"outline",size:"sm",onClick:()=>K(s),className:"px-3",children:[s,s===1&&" - Easy",s===3&&" - Normal",s===5&&" - Hard"]},s))})]})]}),e.jsxs(B,{children:[e.jsx(i,{variant:"outline",onClick:()=>f(!1),disabled:E,children:"Cancel"}),e.jsx(i,{onClick:pe,disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"})]})]})}),e.jsx(z,{open:le,onOpenChange:g,children:e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsx(L,{children:"Exercise Notes"}),e.jsxs(P,{children:["Add notes for ",m!==null?(X=r.exercises[m])==null?void 0:X.name:""]})]}),e.jsx("div",{className:"py-4",children:e.jsx(se,{placeholder:"Add notes about this exercise (form, modifications, etc.)...",value:U,onChange:s=>V(s.target.value),className:"min-h-[150px]"})}),e.jsxs(B,{children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(i,{onClick:fe,children:"Save Notes"})]})]})}),e.jsx(z,{open:ie,onOpenChange:w,children:e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsx(L,{children:"Complete Workout?"}),e.jsx(P,{children:"Are you sure you want to finish this workout? This action will save your progress."})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{children:"Progress:"}),e.jsxs(T,{children:[N(),"% Complete"]})]}),e.jsx(D,{value:N()})]}),e.jsxs(B,{children:[e.jsx(i,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsxs(i,{onClick:ge,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Complete Workout"]})]})]})})]}):e.jsx("div",{className:"flex justify-center items-center h-full",children:"Loading workout..."})};export{Ve as default};
//# sourceMappingURL=ActiveWorkoutPage-DPu5nYQc.js.map
