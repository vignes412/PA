import{j as e,c as ge,r as n,b as ve,B as i}from"./pwa-components-Ba4t8hH-.js";import{u as Ne,x as Ce,D as we,z as be}from"./index-DxPDKD_D.js";import{u as Se,C as Z,B as W,a as D,P as A}from"./progress-CnKH1MjI.js";import{c as ke,C as $,d as O}from"./index-BAGpjJke.js";import{D as z,a as L,b as I,c as P,e as B,I as ee,d as M}from"./dialog-DAGfj3eR.js";import{L as F}from"./label-YxhKVILM.js";import{S as ye}from"./scroll-area-Bnmw-K6Z.js";import{S as Ee}from"./square-pen-g0gOhaH8.js";import{S as Te}from"./save-BsMv5CuY.js";import"./db-utils-DgoSxAK8.js";import"./react-vendor-Csw2ODfV.js";import"./gapiScript-D2rOjFaT.js";/**
 * @license lucide-react v0.509.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],We=ke("arrow-left",Re);function se({className:t,...x}){return e.jsx("textarea",{"data-slot":"textarea",className:ge("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...x})}function De(){const[t,x]=n.useState([]);return{toast:m=>{x(k=>[...k,m]),alert(`${m.title}${m.description?`
`+m.description:""}`)},toasts:t}}const Ge=()=>{var X;const{activeWorkout:t,updateExerciseProgress:x,updateActiveWorkout:f,completeWorkout:m,addExerciseSet:k}=Ne(),{addWorkoutLog:te}=Se(),j=ve(),{toast:d}=De(),[H,_]=n.useState(""),[o,g]=n.useState(null),[re,v]=n.useState(!1),[ae,y]=n.useState(!1),[N,G]=n.useState(!1),[Y,q]=n.useState(null),[l,ne]=n.useState(null),[J,K]=n.useState(""),[ie,C]=n.useState(!1),[w,E]=n.useState(0),[b,T]=n.useState(0),[Q,U]=n.useState(3),R=60,oe=90;n.useEffect(()=>{if(!t)j.push("/");else{_(t.notes||"");const s=t.exercises.findIndex(r=>(r.setsCompleted||0)<r.sets);s!==-1&&g(s)}},[t,j]),n.useEffect(()=>{l&&(E(l.weight||0),T(l.reps||0))},[l]);const le=()=>{if(!t)return"00:00";const s=new Date(t.startTime),a=new Date().getTime()-s.getTime(),c=Math.floor(a/1e3/60),h=Math.floor(c/60),u=c%60;return`${h>0?`${h}h `:""}${u<10?"0":""}${u}m`},ce=()=>{if(!N||!Y)return"00:00";const s=Date.now(),r=Math.floor((s-Y)/1e3),a=Math.floor(r/60),c=r%60;return`${a}:${c<10?"0":""}${c}`},V=(s=R)=>{q(Date.now()),G(!0),d({title:"Rest Timer Started",description:`${s} seconds rest timer started`})},de=()=>{G(!1),q(null)},me=()=>{de(),d({title:"Rest Timer Stopped",description:"Rest timer has been stopped"})},S=()=>{if(!t||!t.exercises)return 0;let s=0,r=0;return t.exercises.forEach(a=>{s+=a.sets,r+=a.setsCompleted||0}),s===0?0:Math.round(r/s*100)},ue=s=>{if(!t)return;const r=t.exercises[s];(r.setsCompleted||0)<r.sets&&(g(s),E(r.weight||0),T(r.reps||0),U(3),ne({...r,index:s}),v(!0))},xe=async()=>{if(!t||o===null||!l)return;const s=t.exercises[o],r=s.setsCompleted||0;if(r<s.sets){x(o,r+1);try{if(await te({date:new Date().toISOString(),muscleGroup:s.muscleGroup,exercise:s.name,reps:b,weight:w,rating:Q,restTime:s.rest||R}),w!==s.weight||b!==s.reps){const a=[...t.exercises];a[o]={...a[o],weight:w,reps:b},f({exercises:a})}d({title:"Set Completed",description:`${s.name} set ${r+1}/${s.sets} logged`,variant:"success"})}catch(a){d({title:"Error",description:"Failed to log workout set. Will try again when online.",variant:"destructive"}),console.error("Error logging workout set:",a)}if(v(!1),V(s.rest||R),r+1>=s.sets){const a=t.exercises.findIndex((c,h)=>h>o&&(c.setsCompleted||0)<c.sets);a!==-1?(V(oe),g(a)):d({title:"Workout Complete",description:"All exercises have been completed! You can finish your workout.",variant:"success"})}}},he=()=>{if(!t||o===null)return;const s=[...t.exercises];s[o]={...s[o],notes:J},f({exercises:s}),C(!1),d({title:"Notes Saved",description:"Exercise notes have been updated."})},pe=()=>{t&&(f({notes:H}),d({title:"Notes Saved",description:"Workout notes have been updated."}))},fe=async()=>{if(!t)return;const s=await m();s.success?(d({title:"Workout Completed",description:"Your workout has been saved.",variant:"success"}),j.push("/")):d({title:"Error",description:s.error||"Failed to complete workout",variant:"destructive"})},je=s=>{t&&(k(s),d({title:"Set Added",description:`Added an extra set to ${t.exercises[s].name}`}))};return n.useEffect(()=>{let s=null;return N&&(s=setInterval(()=>{},1e3)),()=>{s&&clearInterval(s)}},[N]),t?e.jsxs(Ce,{children:[e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>j.push("/"),children:e.jsx(We,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold ml-2",children:"Active Workout"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Z,{className:"h-4 w-4 mr-1 text-muted-foreground"}),e.jsx("span",{children:le()})]}),N&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{variant:"outline",className:"bg-primary/10 text-primary flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),"Rest: ",ce()]}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:me,children:"Stop"})]}),e.jsxs(i,{variant:"default",size:"sm",onClick:()=>y(!0),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Finish Workout"]})]})]}),e.jsx($,{className:"mb-6",children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:t.templateName}),e.jsx("p",{className:"text-muted-foreground",children:t.description})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Overall Progress:"}),e.jsxs("span",{className:"font-medium",children:[S(),"%"]})]}),e.jsx(A,{value:S(),className:"w-40"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"mb-4 flex justify-between items-center",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Exercises"})}),e.jsx(ye,{className:"h-[calc(100vh-300px)]",children:e.jsx("div",{className:"space-y-4 pr-4",children:t.exercises.map((s,r)=>{const a=(s.setsCompleted||0)>=s.sets,c=r===o;return e.jsx($,{className:`${c?"border-primary/50 bg-primary/5":a?"border-muted bg-muted/20":""}`,children:e.jsxs(O,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:`h-4 w-4 ${c?"text-primary":"text-muted-foreground"}`}),e.jsx("h3",{className:"font-medium text-lg",children:s.name})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.sets," sets Ã— ",s.reps," reps",s.weight>0&&` @ ${s.weight}`]})]}),e.jsxs(W,{children:[s.setsCompleted||0,"/",s.sets," Sets"]})]}),e.jsx(A,{value:(s.setsCompleted||0)/s.sets*100,className:"h-1.5 mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Array.from({length:s.sets}).map((h,u)=>{const p=(s.setsCompleted||0)>u;return e.jsxs(i,{size:"sm",variant:p?"default":"outline",className:p?"opacity-70":"",onClick:()=>!p&&ue(r),disabled:p,children:[p?e.jsx(D,{className:"h-3.5 w-3.5 mr-1"}):null,"Set ",u+1]},u)}),a&&e.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>je(r),children:[e.jsx(be,{className:"h-3.5 w-3.5 mr-1"}),"Extra Set"]})]}),s.notes?e.jsxs("div",{className:"mt-3 text-sm p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]}):e.jsxs(i,{size:"sm",variant:"ghost",className:"mt-2 text-xs",onClick:()=>{g(r),K(s.notes||""),C(!0)},children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"Add Notes"]})]})},r)})})})]}),e.jsx("div",{children:e.jsx($,{className:"sticky top-4",children:e.jsxs(O,{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Workout Notes"}),e.jsx(se,{placeholder:"Add notes about your workout here...",value:H,onChange:s=>_(s.target.value),className:"min-h-[150px] mb-4"}),e.jsxs(i,{onClick:pe,className:"w-full",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Save Notes"]})]})})})]})]}),e.jsx(z,{open:re,onOpenChange:v,children:e.jsxs(L,{children:[e.jsxs(I,{children:[e.jsx(P,{children:"Log Exercise Set"}),e.jsxs(B,{children:["Record details for ",l==null?void 0:l.name," - Set ",((l==null?void 0:l.setsCompleted)||0)+1]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"weight",children:"Weight"}),e.jsx(ee,{id:"weight",type:"number",min:0,value:w,onChange:s=>E(Number(s.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"reps",children:"Reps"}),e.jsx(ee,{id:"reps",type:"number",min:0,value:b,onChange:s=>T(Number(s.target.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Rating (How difficult was this set?)"}),e.jsx("div",{className:"flex justify-between pt-2",children:[1,2,3,4,5].map(s=>e.jsxs(i,{type:"button",variant:Q===s?"default":"outline",size:"sm",onClick:()=>U(s),className:"px-3",children:[s,s===1&&" - Easy",s===3&&" - Normal",s===5&&" - Hard"]},s))})]})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(i,{onClick:xe,children:"Save"})]})]})}),e.jsx(z,{open:ie,onOpenChange:C,children:e.jsxs(L,{children:[e.jsxs(I,{children:[e.jsx(P,{children:"Exercise Notes"}),e.jsxs(B,{children:["Add notes for ",o!==null?(X=t.exercises[o])==null?void 0:X.name:""]})]}),e.jsx("div",{className:"py-4",children:e.jsx(se,{placeholder:"Add notes about this exercise (form, modifications, etc.)...",value:J,onChange:s=>K(s.target.value),className:"min-h-[150px]"})}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(i,{onClick:he,children:"Save Notes"})]})]})}),e.jsx(z,{open:ae,onOpenChange:y,children:e.jsxs(L,{children:[e.jsxs(I,{children:[e.jsx(P,{children:"Complete Workout?"}),e.jsx(B,{children:"Are you sure you want to finish this workout? This action will save your progress."})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{children:"Progress:"}),e.jsxs(W,{children:[S(),"% Complete"]})]}),e.jsx(A,{value:S()})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(i,{onClick:fe,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Complete Workout"]})]})]})})]}):e.jsx("div",{className:"flex justify-center items-center h-full",children:"Loading workout..."})};export{Ge as default};
//# sourceMappingURL=ActiveWorkoutPage-CgCTtemB.js.map
